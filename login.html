<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - QB QUIZ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #000; 
            color: white; 
            overflow-x: hidden;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .input-field {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
            outline: none;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -10px rgba(59, 130, 246, 0.5);
        }
        /* Particle Background placeholder */
        #bg-canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.4; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen relative">

    <canvas id="bg-canvas"></canvas>

    <div class="w-full max-w-md p-6">
        
        <div id="auth-card" class="glass-panel rounded-2xl p-8 relative overflow-hidden">
            
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">
                    QB QUIZ
                </h1>
                <p class="text-gray-400 text-sm mt-2">Secure Assessment Portal</p>
            </div>

            <div id="step-email" class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Email Address</label>
                    <input type="email" id="email-input" class="input-field w-full rounded-lg px-4 py-3" placeholder="mrdwarkesh65@gmail.com">
                </div>
                <button onclick="sendOTP()" class="btn-primary w-full py-3 rounded-lg font-semibold">
                    Send Verification OTP
                </button>
                <div class="text-center mt-4">
                    <p class="text-xs text-gray-500">OTP will be sent to verify your identity.</p>
                </div>
            </div>

            <div id="step-otp" class="hidden space-y-4">
                <div class="text-center mb-4">
                    <p class="text-sm text-gray-300">Enter code sent to <span id="display-email" class="text-blue-400 font-mono"></span></p>
                </div>
                <div class="flex justify-between gap-2">
                    <input type="text" id="otp-input" class="input-field w-full text-center text-2xl tracking-widest rounded-lg py-3" maxlength="6" placeholder="000000">
                </div>
                <button onclick="verifyOTP()" class="btn-primary w-full py-3 rounded-lg font-semibold">
                    Verify OTP
                </button>
                <button onclick="resetToEmail()" class="w-full text-sm text-gray-400 hover:text-white mt-2">Change Email</button>
            </div>

            <div id="step-final" class="hidden space-y-4">
                <div class="text-center text-green-400 mb-4 text-sm font-semibold">
                    ✓ Email Verified
                </div>
                <div id="name-field-container" class="hidden">
                    <label class="block text-sm text-gray-400 mb-1">Full Name</label>
                    <input type="text" id="name-input" class="input-field w-full rounded-lg px-4 py-3" placeholder="Dwarkesh Savaliya">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Password</label>
                    <input type="password" id="password-input" class="input-field w-full rounded-lg px-4 py-3" placeholder="••••••••">
                </div>
                <button id="action-btn" class="btn-primary w-full py-3 rounded-lg font-semibold">
                    Secure Login
                </button>
                <div id="toggle-auth" class="text-center mt-4">
                    <button onclick="toggleMode()" class="text-sm text-blue-400 hover:text-blue-300">
                        New user? Create Account
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script type="module">
        // --- FIREBASE CONFIG (YOURS) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAA9WGhpWt5rfBsN0rIThp_Vd9gwwJlJwY",
            authDomain: "website-mcq-5d390.firebaseapp.com",
            projectId: "website-mcq-5d390",
            storageBucket: "website-mcq-5d390.firebasestorage.app",
            messagingSenderId: "792788612285",
            appId: "1:792788612285:web:34f17eede0307ee65233d4",
            measurementId: "G-Q1ZXF235FM"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- AUTH STATE CHECK ---
        onAuthStateChanged(auth, (user) => {
            if (user) window.location.href = "index.html";
        });

        // --- GLOBAL VARS ---
        let currentOTP = null;
        let isSignup = false;
        
        // --- UI FUNCTIONS ---
        window.resetToEmail = () => {
            gsap.to("#step-otp", {opacity:0, duration:0.3, onComplete: () => {
                document.getElementById("step-otp").classList.add("hidden");
                document.getElementById("step-email").classList.remove("hidden");
                gsap.fromTo("#step-email", {opacity:0, x:-20}, {opacity:1, x:0});
            }});
        };

        window.toggleMode = () => {
            isSignup = !isSignup;
            const toggleBtn = document.querySelector("#toggle-auth button");
            const actionBtn = document.getElementById("action-btn");
            const nameField = document.getElementById("name-field-container");

            if (isSignup) {
                nameField.classList.remove("hidden");
                actionBtn.textContent = "Create Account";
                toggleBtn.textContent = "Already have an account? Login";
            } else {
                nameField.classList.add("hidden");
                actionBtn.textContent = "Secure Login";
                toggleBtn.textContent = "New user? Create Account";
            }
        };

        // --- OTP LOGIC (SIMULATED) ---
        window.sendOTP = () => {
            const email = document.getElementById("email-input").value;
            if(!email.includes("@")) { alert("Please enter a valid email"); return; }

            // GENERATE OTP
            currentOTP = Math.floor(100000 + Math.random() * 900000).toString();
            
            // SIMULATE SENDING EMAIL (Since we are client-side only)
            // In a real app, you would call your backend API here.
            console.log(`Sending OTP to ${email} from mrdwarkesh65@gmail.com`);
            
            // DEMO ALERT
            alert(`[DEMO] Email sent to ${email}.\nYour OTP is: ${currentOTP}`);

            // UI TRANSITION
            document.getElementById("display-email").textContent = email;
            
            gsap.to("#step-email", {opacity:0, x:-20, duration:0.3, onComplete: () => {
                document.getElementById("step-email").classList.add("hidden");
                document.getElementById("step-otp").classList.remove("hidden");
                gsap.fromTo("#step-otp", {opacity:0, x:20}, {opacity:1, x:0});
            }});
        };

        window.verifyOTP = () => {
            const userOtp = document.getElementById("otp-input").value;
            if (userOtp === currentOTP) {
                // SUCCESS TRANSITION
                gsap.to("#step-otp", {opacity:0, x:-20, duration:0.3, onComplete: () => {
                    document.getElementById("step-otp").classList.add("hidden");
                    document.getElementById("step-final").classList.remove("hidden");
                    gsap.fromTo("#step-final", {opacity:0, x:20}, {opacity:1, x:0});
                }});
            } else {
                alert("Invalid OTP. Please try again.");
                document.getElementById("otp-input").value = "";
            }
        };

        // --- FINAL LOGIN/SIGNUP ---
        document.getElementById("action-btn").addEventListener("click", async () => {
            const email = document.getElementById("email-input").value;
            const password = document.getElementById("password-input").value;
            const name = document.getElementById("name-input").value;

            try {
                if (isSignup) {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await updateProfile(userCredential.user, { displayName: name });
                    
                    // Save User to Firestore
                    await setDoc(doc(db, "users", userCredential.user.uid), {
                        name: name,
                        email: email,
                        createdAt: new Date()
                    });
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                }
                // Redirect happens automatically via onAuthStateChanged
            } catch (error) {
                alert("Error: " + error.message);
            }
        });
        
        // --- CANVAS BACKGROUND ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const stars = Array(100).fill().map(() => ({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 2,
            speed: Math.random() * 0.5
        }));

        function animateBg() {
            ctx.fillStyle = 'rgba(0,0,0,0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            stars.forEach(star => {
                star.y -= star.speed;
                if(star.y < 0) star.y = canvas.height;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
            requestAnimationFrame(animateBg);
        }
        animateBg();

    </script>
</body>
</html>
